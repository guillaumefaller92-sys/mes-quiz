<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pok√©dex Quiz ‚Äì Gen 1 (Kanto)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --card:#0b1226cc;
      --line:#ffffff1f;
      --text:#e8eefc;
      --muted:#b7c2df;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(229,57,53,.22), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(59,130,246,.22), transparent 55%),
        radial-gradient(700px 400px at 60% 95%, rgba(34,197,94,.16), transparent 60%),
        linear-gradient(180deg, #070b16, #0b1024 65%, #070b16);
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed;
      inset:-30px;
      pointer-events:none;
      opacity:.12;
      background-image:
        radial-gradient(circle at 15px 15px, #ffffff 0 4px, transparent 4px 100%),
        radial-gradient(circle at 15px 15px, #000000 0 7px, transparent 7px 100%),
        linear-gradient(#e53935 0 50%, #ffffff 50% 100%);
      background-size: 80px 80px;
      transform: rotate(-4deg);
    }

    .wrap{ width:min(1120px, 100%); display:grid; gap:16px; }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .brand{ display:flex; align-items:center; gap:12px; }
    .pokeball{
      width:44px; height:44px; border-radius:999px;
      background:
        radial-gradient(circle at 50% 50%, #fff 0 8px, #111 8px 10px, #fff 10px 12px, transparent 12px),
        linear-gradient(#e53935 0 50%, #fff 50% 100%);
      border:3px solid #111;
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
      position:relative;
    }
    .pokeball::after{
      content:""; position:absolute; left:-3px; right:-3px; top:50%; height:3px;
      background:#111; transform: translateY(-50%);
    }

    .title h1{
      margin:0;
      font-family:"Press Start 2P", monospace;
      font-size:16px;
      letter-spacing:.4px;
      line-height:1.3;
    }
    .title p{ margin:6px 0 0; color:var(--muted); font-size:13px; }

    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-weight:800;
      font-size:13px;
    }
    .pill strong{ color: var(--text); }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .cardHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      background:
        linear-gradient(90deg, rgba(229,57,53,.16), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), transparent);
      flex-wrap:wrap;
    }
    .count{
      font-family:"Press Start 2P", monospace;
      font-size:14px;
    }

    .btn{
      cursor:pointer;
      user-select:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding:12px 14px;
      border-radius:14px;
      font-weight:800;
    }
    .btn:hover{ background: rgba(255,255,255,.12); }
    .btn.primary{
      border-color: rgba(229,57,53,.45);
      background: rgba(229,57,53,.16);
    }
    .btn.primary:hover{ background: rgba(229,57,53,.22); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .bar{
      width:100%;
      height:14px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--line);
      overflow:hidden;
      margin-top:12px;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(34,197,94,1), rgba(59,130,246,1));
      transition: width .25s ease;
    }

    .inputArea{ padding:16px 18px 10px; display:grid; gap:10px; }
    .inputRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input{
      flex: 1 1 340px;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      color:var(--text);
      font-size:16px;
      outline:none;
    }
    input:focus{ border-color: rgba(59,130,246,.6); box-shadow: 0 0 0 4px rgba(59,130,246,.18); }

    .hint{
      color:var(--muted);
      font-size:12.5px;
      line-height:1.35;
      padding:0 18px 12px;
    }
    .toast{ min-height:18px; font-weight:800; font-size:13px; padding:0 18px 14px; }
    .toast.good{ color: var(--good); }
    .toast.warn{ color: var(--warn); }
    .toast.bad{ color: var(--bad); }

    .gridWrap{ padding: 0 18px 18px; }
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap:10px;
      max-height: 540px;
      overflow:auto;
      padding-right: 6px;
    }

    .cell{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius:16px;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: var(--muted);
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    .cell:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }

    .cell.found{
      color: var(--text);
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.10);
    }

    /* ‚úÖ cellule r√©v√©l√©e via abandon (solutions en rouge) */
    .cell.revealed{
      color: var(--text);
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.08);
    }
    .cell.revealed .name{
      color: var(--bad);
      font-weight: 900;
    }

    .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }

    .sprite{
      width:40px;
      height:40px;
      image-rendering: pixelated;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      padding:2px;
      flex: 0 0 auto;
      display:none;
    }
    .cell.found .sprite{ display:block; }
    .cell.revealed .sprite{ display:block; }

    .num{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.2);
      border-radius:10px;
      padding:3px 7px;
      color: var(--text);
      min-width:54px;
      text-align:center;
      flex: 0 0 auto;
    }
    .name{
      font-weight:800;
      color: inherit;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .status{
      flex: 0 0 auto;
      font-size: 14px;
      opacity:.9;
    }

    .masked{
      letter-spacing:.6px;
      font-weight:700;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="pokeball" aria-hidden="true"></div>
        <div class="title">
          <h1>Pok√©dex Quiz ‚Äì G√©n√©ration 1 (Kanto)</h1>
          <p>Num√©ros visibles, noms masqu√©s, sprites √† la d√©couverte.</p>
        </div>
      </div>

      <div class="meta">
        <button class="btn" id="btnHome">üè† Accueil</button>
        <div class="pill">‚è±Ô∏è Temps : <strong id="timer">00:00</strong></div>
        <div class="pill">üéØ Score : <strong id="score">0</strong>/151</div>
        <button class="btn" id="btnPause">‚è∏Ô∏è Pause</button>
        <button class="btn primary" id="btnReset">üîÑ Recommencer</button>
        <button class="btn" id="btnGiveUp">üè≥Ô∏è Abandonner</button>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <div>
          <div class="count" id="count">0 / 151</div>
          <div class="bar"><div class="fill" id="fill"></div></div>
        </div>
        <div class="hint" style="padding:0; max-width:560px;">
          Accents/espaces/points ignor√©s (ex: <em>M. Mime</em>).<br>
          Si tu tapes <strong>Nidoran</strong>, √ßa r√©v√®le <strong>Nidoran‚ôÄ</strong> et <strong>Nidoran‚ôÇ</strong>.<br>
          ‚úÖ Validation auto d√®s que le nom correspond (pas besoin d‚ÄôEntr√©e).
        </div>
      </div>

      <div class="inputArea">
        <div class="inputRow">
          <input id="input" type="text" placeholder="Tape un Pok√©mon‚Ä¶ (ex: pikachu, nidoran, mrmime)" autocomplete="off" />
          <button class="btn" id="btnSubmit">‚úÖ Valider</button>
        </div>
      </div>
      <div id="toast" class="toast"></div>

      <div class="gridWrap">
        <div class="grid" id="grid"></div>
      </div>
    </div>
  </div>

<script>
  // --------- Utils ----------
  function normalize(str) {
    return (str || "")
      .trim()
      .toLowerCase()
      // ‚úÖ garde l'info de genre pour Nidoran
      .replace(/‚ôÄ/g, "f")
      .replace(/‚ôÇ/g, "m")
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/[^a-z0-9]/g, "");
  }
  function pad3(n){ return String(n).padStart(3, "0"); }

  function spriteUrl(num) {
    return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${num}.png`;
  }

  // --------- Data ----------
  const gen1 = [
    [1,"Bulbizarre"],[2,"Herbizarre"],[3,"Florizarre"],[4,"Salam√®che"],[5,"Reptincel"],[6,"Dracaufeu"],
    [7,"Carapuce"],[8,"Carabaffe"],[9,"Tortank"],[10,"Chenipan"],[11,"Chrysacier"],[12,"Papilusion"],
    [13,"Aspicot"],[14,"Coconfort"],[15,"Dardargnan"],[16,"Roucool"],[17,"Roucoups"],[18,"Roucarnage"],
    [19,"Rattata"],[20,"Rattatac"],[21,"Piafabec"],[22,"Rapasdepic"],[23,"Abo"],[24,"Arbok"],
    [25,"Pikachu"],[26,"Raichu"],[27,"Sabelette"],[28,"Sablaireau"],[29,"Nidoran‚ôÄ"],[30,"Nidorina"],
    [31,"Nidoqueen"],[32,"Nidoran‚ôÇ"],[33,"Nidorino"],[34,"Nidoking"],[35,"M√©lof√©e"],[36,"M√©lodelfe"],
    [37,"Goupix"],[38,"Feunard"],[39,"Rondoudou"],[40,"Grodoudou"],[41,"Nosferapti"],[42,"Nosferalto"],
    [43,"Mystherbe"],[44,"Ortide"],[45,"Rafflesia"],[46,"Paras"],[47,"Parasect"],[48,"Mimitoss"],
    [49,"A√©romite"],[50,"Taupiqueur"],[51,"Triopikeur"],[52,"Miaouss"],[53,"Persian"],[54,"Psykokwak"],
    [55,"Akwakwak"],[56,"F√©rosinge"],[57,"Colossinge"],[58,"Caninos"],[59,"Arcanin"],[60,"Ptitard"],
    [61,"T√™tarte"],[62,"Tartard"],[63,"Abra"],[64,"Kadabra"],[65,"Alakazam"],[66,"Machoc"],
    [67,"Machopeur"],[68,"Mackogneur"],[69,"Ch√©tiflor"],[70,"Boustiflor"],[71,"Empiflor"],[72,"Tentacool"],
    [73,"Tentacruel"],[74,"Racaillou"],[75,"Gravalanch"],[76,"Grolem"],[77,"Ponyta"],[78,"Galopa"],
    [79,"Ramoloss"],[80,"Flagadoss"],[81,"Magn√©ti"],[82,"Magn√©ton"],[83,"Canarticho"],[84,"Doduo"],
    [85,"Dodrio"],[86,"Otaria"],[87,"Lamantine"],[88,"Tadmorv"],[89,"Grotadmorv"],[90,"Kokiyas"],
    [91,"Crustabri"],[92,"Fantominus"],[93,"Spectrum"],[94,"Ectoplasma"],[95,"Onix"],[96,"Soporifik"],
    [97,"Hypnomade"],[98,"Krabby"],[99,"Krabboss"],[100,"Voltorbe"],[101,"√âlectrode"],[102,"Noeunoeuf"],
    [103,"Noadkoko"],[104,"Osselait"],[105,"Ossatueur"],[106,"Kicklee"],[107,"Tygnon"],[108,"Excelangue"],
    [109,"Smogo"],[110,"Smogogo"],[111,"Rhinocorne"],[112,"Rhinof√©ros"],[113,"Leveinard"],[114,"Saquedeneu"],
    [115,"Kangourex"],[116,"Hypotrempe"],[117,"Hypoc√©an"],[118,"Poissir√®ne"],[119,"Poissoroy"],[120,"Stari"],
    [121,"Staross"],[122,"M. Mime"],[123,"Ins√©cateur"],[124,"Lippoutou"],[125,"√âlektek"],[126,"Magmar"],
    [127,"Scarabrute"],[128,"Tauros"],[129,"Magicarpe"],[130,"L√©viator"],[131,"Lokhlass"],[132,"M√©tamorph"],
    [133,"√âvoli"],[134,"Aquali"],[135,"Voltali"],[136,"Pyroli"],[137,"Porygon"],[138,"Amonita"],
    [139,"Amonistar"],[140,"Kabuto"],[141,"Kabutops"],[142,"Pt√©ra"],[143,"Ronflex"],[144,"Artikodin"],
    [145,"√âlecthor"],[146,"Sulfura"],[147,"Minidraco"],[148,"Draco"],[149,"Dracolosse"],[150,"Mewtwo"],
    [151,"Mew"]
  ];

  const byKey = new Map();
  for (const [num, name] of gen1) byKey.set(normalize(name), { num, name });

  const aliasToKey = new Map([
    ["nidoranf", normalize("Nidoran‚ôÄ")],
    ["nidoranm", normalize("Nidoran‚ôÇ")],
    ["mrmime", normalize("M. Mime")],
    ["mr.mime", normalize("M. Mime")],
    ["m.mime", normalize("M. Mime")]
  ]);

  const TOTAL = 151;
  const foundKeys = new Set();

  // --------- Timer (avec pause) ----------
  let timerInterval = null;
  let startTs = null;
  let elapsedMs = 0;
  let isPaused = false;
  let isFinished = false;

  // ‚úÖ √©tat abandon
  let isGivenUp = false;

  function fmtTimeFromMs(ms) {
    const seconds = Math.floor(ms / 1000);
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }

  function renderTimer() {
    timerEl.textContent = fmtTimeFromMs(elapsedMs + (startTs ? (Date.now() - startTs) : 0));
  }

  function stopTimerIntervalOnly() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = null;
  }

  function startTimerIfNeeded() {
    if (isFinished || isPaused || isGivenUp) return;
    if (timerInterval) return;
    if (!startTs) startTs = Date.now();
    timerInterval = setInterval(renderTimer, 250);
  }

  function stopTimer() {
    if (startTs) { elapsedMs += (Date.now() - startTs); startTs = null; }
    stopTimerIntervalOnly();
    renderTimer();
  }

  function resetTimer() {
    stopTimerIntervalOnly();
    startTs = null;
    elapsedMs = 0;
    isPaused = false;
    isFinished = false;
    isGivenUp = false;
    btnPause.disabled = false;
    btnPause.textContent = "‚è∏Ô∏è Pause";
    timerEl.textContent = "00:00";
  }

  function pauseTimer() {
    if (isFinished || isGivenUp || isPaused) return;
    if (startTs) { elapsedMs += (Date.now() - startTs); startTs = null; }
    stopTimerIntervalOnly();
    isPaused = true;
    btnPause.textContent = "‚ñ∂Ô∏è Reprendre";
    setToast("warn", "‚è∏Ô∏è Timer en pause.");
  }

  function resumeTimer() {
    if (isFinished || isGivenUp || !isPaused) return;
    isPaused = false;
    startTs = Date.now();
    btnPause.textContent = "‚è∏Ô∏è Pause";
    setToast("", "");
    startTimerIfNeeded();
  }

  function togglePause() {
    if (isFinished || isGivenUp) return;
    if (isPaused) resumeTimer();
    else pauseTimer();
  }

  // --------- UI ----------
  const input = document.getElementById("input");
  const toast = document.getElementById("toast");
  const countEl = document.getElementById("count");
  const fillEl = document.getElementById("fill");
  const gridEl = document.getElementById("grid");
  const scoreEl = document.getElementById("score");
  const timerEl = document.getElementById("timer");
  const btnPause = document.getElementById("btnPause");

  const btnGiveUp = document.getElementById("btnGiveUp");
  const btnSubmit = document.getElementById("btnSubmit");

  function setToast(type, msg) {
    toast.className = "toast " + (type || "");
    toast.textContent = msg || "";
  }

  function updateStats() {
    const n = foundKeys.size;
    countEl.textContent = `${n} / ${TOTAL}`;
    scoreEl.textContent = n;
    fillEl.style.width = `${(n / TOTAL) * 100}%`;
  }

  function buildGrid() {
    gridEl.innerHTML = "";
    for (let num = 1; num <= TOTAL; num++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.id = `cell-${num}`;
      cell.innerHTML = `
        <div class="left">
          <img class="sprite" id="sprite-${num}" alt="" />
          <div class="num">#${pad3(num)}</div>
          <div class="name masked" id="name-${num}">??????</div>
        </div>
        <div class="status" id="status-${num}">‚Äî</div>
      `;
      gridEl.appendChild(cell);
    }
  }

  function revealByKey(key) {
    if (!byKey.has(key)) return { changed:false, msg:null };
    if (foundKeys.has(key)) {
      const { num, name } = byKey.get(key);
      return { changed:false, msg:`‚ö†Ô∏è D√©j√† trouv√© : #${pad3(num)} ${name}` };
    }

    const { num, name } = byKey.get(key);
    foundKeys.add(key);

    const cell = document.getElementById(`cell-${num}`);
    const nameEl = document.getElementById(`name-${num}`);
    const statusEl = document.getElementById(`status-${num}`);
    const spriteEl = document.getElementById(`sprite-${num}`);

    cell.classList.add("found");
    cell.classList.remove("revealed");
    nameEl.textContent = name;
    nameEl.classList.remove("masked");
    statusEl.textContent = "‚úÖ";

    spriteEl.src = spriteUrl(num);
    spriteEl.alt = name;

    cell.animate(
      [{ transform:"translateY(0)" }, { transform:"translateY(-2px)" }, { transform:"translateY(0)" }],
      { duration: 160, easing: "ease-out" }
    );

    cell.scrollIntoView({ behavior: "smooth", block: "nearest" });

    return { changed:true, msg:`‚úÖ Bien jou√© : #${pad3(num)} ${name}` };
  }

  // ‚úÖ r√©v√®le ce qui manque en rouge (abandon)
  function revealMissingSolutions() {
    for (const [key, { num, name }] of byKey.entries()) {
      if (foundKeys.has(key)) continue;

      const cell = document.getElementById(`cell-${num}`);
      const nameEl = document.getElementById(`name-${num}`);
      const statusEl = document.getElementById(`status-${num}`);
      const spriteEl = document.getElementById(`sprite-${num}`);

      cell.classList.add("revealed");
      nameEl.textContent = name;
      nameEl.classList.remove("masked");
      statusEl.textContent = "‚ùå";

      spriteEl.src = spriteUrl(num);
      spriteEl.alt = name;
    }
  }

  function giveUp() {
    if (isFinished || isGivenUp) return;

    isGivenUp = true;
    stopTimer();

    btnPause.disabled = true;
    btnPause.textContent = "‚èπÔ∏è Stop";
    input.disabled = true;
    btnSubmit.disabled = true;

    revealMissingSolutions();

    const n = foundKeys.size;
    setToast("bad", `üè≥Ô∏è Abandon : ${n}/${TOTAL} trouv√©s en ${timerEl.textContent}. Solutions affich√©es en rouge.`);
  }

  function finish() {
    isFinished = true;
    stopTimer();

    btnPause.disabled = true;
    btnPause.textContent = "üèÅ Termin√©";
    btnGiveUp.disabled = true;
    input.disabled = true;
    btnSubmit.disabled = true;

    setToast("good", `üèÜ 151/151 ! Pok√©dex compl√©t√© en ${timerEl.textContent} !`);
  }

  // ---- Validation (utilis√©e par submit + auto-try) ----
  function validateRaw(raw) {
    const norm = normalize(raw);
    if (!norm) return;

    // Cas sp√©cial: "nidoran" r√©v√®le les 2
    if (norm === "nidoran") {
      startTimerIfNeeded();

      const kF = normalize("Nidoran‚ôÄ");
      const kM = normalize("Nidoran‚ôÇ");

      const r1 = revealByKey(kF);
      const r2 = revealByKey(kM);

      updateStats();

      const any = r1.changed || r2.changed;
      if (!any) setToast("warn", "‚ö†Ô∏è D√©j√† trouv√© : Nidoran‚ôÄ et Nidoran‚ôÇ");
      else {
        const msgs = [];
        if (r1.changed) msgs.push(r1.msg.replace("‚úÖ Bien jou√© : ", ""));
        if (r2.changed) msgs.push(r2.msg.replace("‚úÖ Bien jou√© : ", ""));
        setToast("good", `‚úÖ R√©v√©l√© : ${msgs.join(" ‚Ä¢ ")}`);
      }

      if (foundKeys.size === TOTAL) finish();
      return;
    }

    const key = aliasToKey.get(norm) || norm;

    if (!byKey.has(key)) {
      // en auto-validation on ne veut PAS spammer d'erreurs
      return { ok:false, reason:"unknown" };
    }

    startTimerIfNeeded();

    const r = revealByKey(key);
    updateStats();
    setToast(r.changed ? "good" : "warn", r.msg);

    if (foundKeys.size === TOTAL) finish();
    return { ok:true };
  }

  function submit() {
    if (isGivenUp) {
      setToast("warn", "üè≥Ô∏è Partie abandonn√©e. Clique sur ¬´ Recommencer ¬ª pour rejouer.");
      input.value = "";
      return;
    }
    if (isPaused) {
      setToast("warn", "‚è∏Ô∏è Le timer est en pause. Clique sur ¬´ Reprendre ¬ª pour continuer.");
      input.value = "";
      input.focus();
      return;
    }

    const raw = input.value;
    input.value = "";
    input.focus();

    const norm = normalize(raw);
    if (!norm) { setToast("warn", "‚ö†Ô∏è Tape un nom de Pok√©mon."); return; }

    // en submit manuel, on accepte un message d'erreur si inconnu
    const key = aliasToKey.get(norm) || norm;
    if (norm !== "nidoran" && !byKey.has(key)) {
      setToast("bad", "‚ùå Pas un Pok√©mon de la 1√®re g√©n√©ration (ou orthographe non reconnue).");
      return;
    }

    validateRaw(raw);
  }

  function resetQuiz() {
    foundKeys.clear();
    buildGrid();
    updateStats();
    setToast("", "");
    resetTimer();

    input.disabled = false;
    btnSubmit.disabled = false;
    btnGiveUp.disabled = false;

    input.value = "";
    input.focus();
  }

  // ‚úÖ Emp√™che l'auto-validation si la saisie est un pr√©fixe d'un autre Pok√©mon non trouv√©
  function isPrefixOfAnotherUnfound(normKey) {
    if (!normKey) return false;

    for (const [k] of byKey.entries()) {
      if (k === normKey) continue;
      if (k.startsWith(normKey) && !foundKeys.has(k)) return true;
    }
    return false;
  }

  // ‚úÖ Auto-validation (match exact) + anti-spam + gestion mew/mewtwo
  let autoT = null;

  function autoTryValidate() {
    if (isPaused || isFinished || isGivenUp) return;

    const raw = input.value;
    const norm = normalize(raw);
    if (!norm) return;

    // "nidoran" = cas sp√©cial
    if (norm === "nidoran") {
      input.value = "";
      validateRaw("nidoran");
      input.focus();
      return;
    }

    const key = aliasToKey.get(norm) || norm;

    // ‚úÖ si c'est un pr√©fixe d'un autre Pok√©mon non trouv√© (ex: mew -> mewtwo), on attend
    if (isPrefixOfAnotherUnfound(key)) return;

    if (byKey.has(key)) {
      input.value = "";
      validateRaw(raw);
      input.focus();
    }
  }

  input.addEventListener("input", () => {
    clearTimeout(autoT);
    autoT = setTimeout(autoTryValidate, 120);
  });

  // Events
  btnSubmit.addEventListener("click", submit);
  document.getElementById("btnReset").addEventListener("click", resetQuiz);
  btnPause.addEventListener("click", togglePause);
  btnGiveUp.addEventListener("click", giveUp);

  // (optionnel) Entr√©e marche encore, mais n'est plus n√©cessaire
  input.addEventListener("keydown", (e) => { if (e.key === "Enter") submit(); });

  const btnHome = document.getElementById("btnHome");
  btnHome.addEventListener("click", () => {
    window.location.href = "index.html";
  });

  // init
  buildGrid();
  updateStats();
  input.focus();
</script>
</body>
</html>